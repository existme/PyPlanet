

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Apps &mdash; PyPlanet  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="PyPlanet  documentation" href="../index.html"/>
        <link rel="next" title="API Documentation" href="../api/index.html"/>
        <link rel="prev" title="Core" href="../core/index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> PyPlanet
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core/index.html">Core</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Apps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#life-cycle">Life Cycle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#on-init">on_init</a></li>
<li class="toctree-l3"><a class="reference internal" href="#on-start">on_start</a></li>
<li class="toctree-l3"><a class="reference internal" href="#on-stop">on_stop</a></li>
<li class="toctree-l3"><a class="reference internal" href="#on-destroy">on_destroy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#models">Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#define-models">Define models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fields">Fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="#operations">Operations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#migrations">Migrations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create-migrations">Create migrations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PyPlanet</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Apps</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/apps/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="apps">
<h1><a class="toc-backref" href="#id1">Apps</a><a class="headerlink" href="#apps" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#apps" id="id1">Apps</a><ul>
<li><a class="reference internal" href="#life-cycle" id="id2">Life Cycle</a><ul>
<li><a class="reference internal" href="#on-init" id="id3">on_init</a></li>
<li><a class="reference internal" href="#on-start" id="id4">on_start</a></li>
<li><a class="reference internal" href="#on-stop" id="id5">on_stop</a></li>
<li><a class="reference internal" href="#on-destroy" id="id6">on_destroy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#models" id="id7">Models</a><ul>
<li><a class="reference internal" href="#define-models" id="id8">Define models</a></li>
<li><a class="reference internal" href="#fields" id="id9">Fields</a></li>
<li><a class="reference internal" href="#operations" id="id10">Operations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrations" id="id11">Migrations</a><ul>
<li><a class="reference internal" href="#create-migrations" id="id12">Create migrations</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="life-cycle">
<h2><a class="toc-backref" href="#id2">Life Cycle</a><a class="headerlink" href="#life-cycle" title="Permalink to this headline">¶</a></h2>
<img alt="../_images/lifecycle.png" src="../_images/lifecycle.png" />
<div class="section" id="on-init">
<h3><a class="toc-backref" href="#id3">on_init</a><a class="headerlink" href="#on-init" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">on_init()</span></code> is called the moment after the apps have been ordered at the dependency trees. This means, there is not
yet a stable point to communicate to apps, so it should only initiate local actions, such as clearing variables,
initing related services (like startup of http server).</p>
<p>The <code class="docutils literal"><span class="pre">on_init()</span></code> method is a <cite>coroutine</cite> and will be waited on before starting the other apps init action.</p>
</div>
<div class="section" id="on-start">
<h3><a class="toc-backref" href="#id4">on_start</a><a class="headerlink" href="#on-start" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">on_start()</span></code> is called at the moment all apps, models and other components are ready and the apps should be started.
In the method you should init the receivers inside of your app, make an active operation that would init remote connections.
For example, you would really like to start showing UI for all players, or initiate local variables based on other apps
or the player manager.</p>
<p>The <code class="docutils literal"><span class="pre">on_start()</span></code> method is a <cite>coroutine</cite> and will be waited on.</p>
</div>
<div class="section" id="on-stop">
<h3><a class="toc-backref" href="#id5">on_stop</a><a class="headerlink" href="#on-stop" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">on_stop()</span></code> is called when stopping the app internally (so not when exitting PyPlanet!). Some situations like
game mode switching will make sure that no apps are being active at the moment of playing an incapable game-mode, game or
another app is unloaded that was depending on your app.</p>
<p>PyPlanet will make sure your UI elements are hide from your players, so you don&#8217;t have to do this. But remember that the
app could start at any time, meaning that some context would not be valid anymore, and you should take care of this in the
<code class="docutils literal"><span class="pre">on_start()</span></code> again.</p>
<p>The <code class="docutils literal"><span class="pre">on_stop()</span></code> method is a <cite>coroutine</cite> and will be waited on.</p>
</div>
<div class="section" id="on-destroy">
<h3><a class="toc-backref" href="#id6">on_destroy</a><a class="headerlink" href="#on-destroy" title="Permalink to this headline">¶</a></h3>
<p>This method is only called when the app is going to be removed from memory, just before. Mostly only used to save some data.</p>
<p>The <code class="docutils literal"><span class="pre">on_destroy()</span></code> method is a <cite>coroutine</cite> and will be waited on.</p>
</div>
</div>
<div class="section" id="models">
<h2><a class="toc-backref" href="#id7">Models</a><a class="headerlink" href="#models" title="Permalink to this headline">¶</a></h2>
<p>Models are defined in either the <code class="docutils literal"><span class="pre">app/models.py</span></code> file or the <code class="docutils literal"><span class="pre">app/models/</span></code> folder (with loading from the <code class="docutils literal"><span class="pre">app/models/__init__.py</span></code>)</p>
<p>Models tables are created at the moment PyPlanet starts for the first time as it sees your model, and not yet have a table.
To adjust models you should create migrations.</p>
<div class="section" id="define-models">
<h3><a class="toc-backref" href="#id8">Define models</a><a class="headerlink" href="#define-models" title="Permalink to this headline">¶</a></h3>
<p>You have two base classes where your model class could inherit from, we recommend to use the <code class="docutils literal"><span class="pre">TimedModel</span></code> most of the times.
There are a few exceptions where we recommend the base <code class="docutils literal"><span class="pre">Model</span></code>, for example glue models. Or very data-intensive or data where
you don&#8217;t need to know when it&#8217;s created or updated.</p>
<p>The <code class="docutils literal"><span class="pre">TimedModel</span></code> includes these two fields for every model: <code class="docutils literal"><span class="pre">created_at</span></code> and <code class="docutils literal"><span class="pre">updated_at</span></code>. Those two fields will
be filled and adjusted automatically when saving/updating.</p>
<p>The <code class="docutils literal"><span class="pre">Model</span></code> includes no fields and is the very base of the model declaration inherit tree.</p>
<p>For defining fields you can use the asterisk import from peewee to have all Fields available in your file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">peewee</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>Examples of model declaration:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Permission</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">namespace</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Namespace of the permission. Mostly the app.label.&#39;</span>
    <span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Name of permission, in format {app_name|core}:{name}&#39;</span>
    <span class="p">)</span>

    <span class="n">description</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Description of permission.&#39;</span>
    <span class="p">)</span>

    <span class="n">min_level</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Minimum required player level to be able to use this permission.&#39;</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">((</span><span class="s1">&#39;namespace&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">),</span> <span class="bp">True</span><span class="p">),</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>For more examples take a look at: <code class="docutils literal"><span class="pre">pyplanet/apps/core/maniaplanet/models/*.py</span></code>. You will find the player and map model
here with lots of examples.</p>
<p>For more information about fields please refer to the Peewee documentation: <a class="reference external" href="http://peewee.readthedocs.io/en/latest/">http://peewee.readthedocs.io/en/latest/</a>.</p>
<p>For more information about operations on models, <strong>don&#8217;t look at the Peewee documentation at first</strong>, but look further in this document.</p>
</div>
<div class="section" id="fields">
<h3><a class="toc-backref" href="#id9">Fields</a><a class="headerlink" href="#fields" title="Permalink to this headline">¶</a></h3>
<p>Please take a look at: <a class="reference external" href="http://peewee.readthedocs.io/en/latest/peewee/models.html#fields">http://peewee.readthedocs.io/en/latest/peewee/models.html#fields</a></p>
</div>
<div class="section" id="operations">
<h3><a class="toc-backref" href="#id10">Operations</a><a class="headerlink" href="#operations" title="Permalink to this headline">¶</a></h3>
<p><strong>Create new object instance in the database</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">instance</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">second_col</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">await</span> <span class="n">instance</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Delete instance from database</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">await</span> <span class="n">instance</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Find instance by id or other unique value (search for one instance)</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">instance</span> <span class="o">=</span> <span class="n">await</span> <span class="n">Model</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">instance</span> <span class="o">=</span> <span class="n">await</span> <span class="n">Model</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">login</span><span class="o">=</span><span class="s1">&#39;toffe&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Find instances (query) by executing query with where condition</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">instances</span> <span class="o">=</span> <span class="n">await</span> <span class="n">Model</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">column</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p><cite>More examples will follow, feel free to ask for help on this topic in the meantime</cite>.</p>
</div>
</div>
<div class="section" id="migrations">
<h2><a class="toc-backref" href="#id11">Migrations</a><a class="headerlink" href="#migrations" title="Permalink to this headline">¶</a></h2>
<p>Migrations of models are handled with the .migrations module contents. It works quite like <cite>Django</cite> migrations work,
except it automatically executes the migrations at first boot.</p>
<div class="section" id="create-migrations">
<h3><a class="toc-backref" href="#id12">Create migrations</a><a class="headerlink" href="#create-migrations" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">To create a migration, go to your app base folder and create a folder (if not yet exist), name the folder <code class="docutils literal"><span class="pre">'migrations'</span></code>.</p>
</li>
<li><p class="first">You should create a new python file with the following name pattern:</p>
<p><code class="docutils literal"><span class="pre">001_name.py</span></code> Where 001 is the migration number, this should be unique and the <cite>name</cite> is a name to represent to the developer.</p>
</li>
<li><p class="first">Past the following snippet and change it like you want.</p>
</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">sample_field</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">upgrade</span><span class="p">(</span><span class="n">migrator</span><span class="p">:</span> <span class="n">SchemaMigrator</span><span class="p">):</span>
    <span class="n">migrate</span><span class="p">(</span>
        <span class="n">migrator</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">TestModel</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">db_table</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">sample_field</span><span class="p">)</span>
    <span class="p">)</span>

<span class="k">def</span> <span class="nf">downgrade</span><span class="p">(</span><span class="n">migrator</span><span class="p">:</span> <span class="n">SchemaMigrator</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li>Change code as you need, but make sure you define defaults or nullable fields, and make sure you use the <code class="docutils literal"><span class="pre">db_table</span></code>
from the meta class of the model.</li>
<li>Make sure you can upgrade at least. Downgrading is not yet included in the scope, but it&#8217;s better to implement the
downgrade as well.</li>
<li>Test, make sure it&#8217;s able to migrate on at least these engines: MySQL, SQLite, PostgreSQL.</li>
</ol>
<p><cite>More information about migrations will appear here as it develops.</cite></p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../api/index.html" class="btn btn-neutral float-right" title="API Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../core/index.html" class="btn btn-neutral" title="Core" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Tom Valk.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>